<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Batch log listeners - Catel documentation</title>
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../css/theme_colors.css" type="text/css" />
    <link rel="stylesheet" href="../../../css/styles/vs.css">
    <link rel="stylesheet" href="../../../css/font-awesome.4.5.0.min.css">
</head>
<body role="document">
    <div class="grid-for-nav">
        <nav data-toggle="nav-shift" class="nav-side stickynav">
            <div class="side-nav-search">
                <a href="../../../index.htm"><i class="fa fa-home"></i> Catel documentation</a>
                <div role="search">
                    <form id="search-form" class="form" action="../../../Docnet_search.htm" method="get">
                        <input type="text" name="q" placeholder="Search docs" />
                    </form>
                </div>
            </div>
            <div class="menu menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
<ul>
<li class="tocentry"><a href="../../../Home.htm">Home</a>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Introduction.htm">Introduction</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../FAQ.htm">FAQ</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Setup,deployment&projects.htm">Setup, deployment & projects</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Gettingstarted.htm">Getting started</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Examples.htm">Examples</a></span>
</li>
<li class="tocentry">
<ul>
<li><span class="navigationgroup"><i class="fa fa-caret-down"></i> <a href="../../../CatelCore.htm">Catel.Core</a></span></li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../ApiCop.htm">ApiCop</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/argument-checking/index.htm">Argument checking</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/caching/index.htm">Caching</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/configuration/index.htm">Configuration</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Datahandling.htm">Data handling</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Exceptionhandling.htm">Exception handling</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../IoC(ServiceLocator&TypeFactory).htm">IoC (ServiceLocator & TypeFactory)</a></span>
</li>
<li class="tocentry">
<ul>
<li><span class="navigationgroup"><i class="fa fa-caret-down"></i> <a href="../../../Logging.htm">Logging</a></span></li>
<li class="tocentry"><a href="../../../catel-core/logging/introduction.htm">Introduction</a>
</li>
<li class="tocentry">
<ul>
<li><span class="navigationgroup"><i class="fa fa-caret-down"></i> <a href="../../../LogListeners.htm">Log Listeners</a></span></li>
<li class="tocentry current"><a class="current" href="../../../catel-core/logging/log-listeners/batch-log-listeners.htm">Batch log listeners</a>
<ul class="currentrelative">
<li class="tocentry"><a href="#flushing-all-listeners">Flushing all listeners</a></li>
<li class="tocentry"><a href="#implementing-a-custom-ibatchloglistener">Implementing a custom IBatchLogListener</a></li>
</ul>
<li class="tocentry"><a href="../../../catel-core/logging/log-listeners/console-log-listener.htm">ConsoleLogListener</a>
</li>
<li class="tocentry"><a href="../../../catel-core/logging/log-listeners/debug-log-listener.htm">DebugLogListener</a>
</li>
<li class="tocentry"><a href="../../../catel-core/logging/log-listeners/event-log-listener.htm">EventLogListener</a>
</li>
<li class="tocentry"><a href="../../../catel-core/logging/log-listeners/event-tracing-for-windows.htm">Event Tracing for Windows (ETW)</a>
</li>
<li class="tocentry"><a href="../../../catel-core/logging/log-listeners/file-log-listener.htm">FileLogListener</a>
</li>
<li class="tocentry"><a href="../../../catel-core/logging/log-listeners/rolling-in-memory-log-listener.htm">RollingInMemoryLogListener</a>
</li>
<li class="tocentry"><a href="../../../catel-core/logging/log-listeners/seq-log-listener.htm">SeqLogListener</a>
</li>

</ul>
</li>
<li class="tocentry"><a href="../../../catel-core/logging/customizing-listeners.htm">Customizing listeners</a>
</li>
<li class="tocentry"><a href="../../../catel-core/logging/creating-log-listeners-via-configuration.htm">Creating log listeners via configuration</a>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Integrationwithexternalloggers.htm">Integration with external loggers</a></span>
</li>
<li class="tocentry"><a href="../../../catel-core/logging/anotar-catel-fody.htm">Anotar.Catel.Fody</a>
</li>

</ul>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Messaging.htm">Messaging</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Multilingual.htm">Multilingual</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Parallelinvocation&tasks.htm">Parallel invocation & tasks</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Pooling.htm">Pooling</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Preventingmemoryleaks.htm">Preventing memory leaks</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Reflection.htm">Reflection</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Scoping.htm">Scoping</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Serialization.htm">Serialization</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../Validation.htm">Validation</a></span>
</li>

</ul>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../CatelMVVM.htm">Catel.MVVM</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../tips-tricks/index.htm">Tips & tricks</a></span>
</li>

</ul>
				<div class="toc-footer">
					<span class="text-small">
						<hr/>
						<a href="https://github.com/FransBouma/DocNet" target="_blank">Made with <i class="fa fa-github"></i> DocNet</a>
					</span>
				</div>	
			</div>
            &nbsp;
        </nav>
        <section data-toggle="nav-shift" class="nav-content-wrap">
            <nav class="nav-top" role="navigation" aria-label="top navigation">
                <i data-toggle="nav-top" class="fa fa-bars"></i>
                <a href="../../../index.htm">Catel documentation</a>
            </nav>
            <div class="nav-content">
                <div role="navigation" aria-label="breadcrumbs navigation">
                    <div class="breadcrumbs">
<ul><li><a href="../../../Home.htm">Home</a></li> / <li><a href="../../../CatelCore.htm">Catel.Core</a></li> / <li><a href="../../../Logging.htm">Logging</a></li> / <li><a href="../../../LogListeners.htm">Log Listeners</a></li> / <li><a href="../../../catel-core/logging/log-listeners/batch-log-listeners.htm">Batch log listeners</a></li></ul>
					
                    </div>
                    <hr />
                </div>
                <div role="main">
                    <div class="section">
<h1 id="batch-log-listeners">Batch log listeners<a class="headerlink" href="#batch-log-listeners" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h1>
<p>A batch log listener is a class implementing the <em>IBatchLogListener</em> interface (and most probably deriving from <em>BatchLogListenerBase</em>). This interface adds a <em>Flush</em> method which allows a listener to be flushed. The advantage is that when a log listener writes to a slower persistence store, it will not have to access this expensive resource for every log event, but by batches.</p>
<h2 id="flushing-all-listeners">Flushing all listeners<a class="headerlink" href="#flushing-all-listeners" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>When using batch log listeners, it is very important to flush the log listeners at important events such as application unhandled exceptions or when the application exits. The reason is that otherwise important log events that are currently in the batch that hasn't been written to the persistence store are lost.</p>
<p>To flush all flushable listeners, use the following method:</p>
<pre class="nocode">LogManager.FlushAll();
</pre><h2 id="implementing-a-custom-ibatchloglistener">Implementing a custom IBatchLogListener<a class="headerlink" href="#implementing-a-custom-ibatchloglistener" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>When implementing a custom batch log listener, it is very wise to derive from the <em>BatchLogListenerBase</em> class. This brings the following advantages:</p>
<ol>
<li>The <em>BatchLogListenerBase</em> is thread-safe</li>
<li>The <em>BatchLogListenerBase</em> automatically flushes the listener every 5 seconds</li>
<li>You only need to implement the <em>WriteBatch</em> which actually writes the entries to the persistence store</li>
</ol>
<p>Below is an example batch log listener:</p>
<pre class="nocode">public class FileLogListener : BatchLogListenerBase
{
    private readonly string _filePath;
    private readonly int _maxSizeInKiloBytes;
    public FileLogListener(string filePath, int maxSizeInKiloBytes)
    {
        Argument.IsNotNullOrWhitespace(() =&gt; filePath);
        _filePath = filePath;
        _maxSizeInKiloBytes = maxSizeInKiloBytes;
    }
    protected override void WriteBatch(System.Collections.Generic.List&lt;LogBatchEntry&gt; batchEntries)
    {
        try
        {
            var fileInfo = new FileInfo(_filePath);
            if (fileInfo.Exists &amp;&amp; (fileInfo.Length / 1024 &gt;= _maxSizeInKiloBytes))
            {
                CreateCopyOfCurrentLogFile(_filePath);
            }
            using (var fileStream = new FileStream(_filePath, FileMode.Append, FileAccess.Write, FileShare.Read))
            {
                using (var writer = new StreamWriter(fileStream))
                {
                    foreach (var batchEntry in batchEntries)
                    {
                        var message = FormatLogEvent(batchEntry.Log, batchEntry.Message, batchEntry.LogEvent, batchEntry.ExtraData);
                        writer.WriteLine(message);
                    }
                }
            }
        }
        catch (Exception)
        {
            // Swallow
        }
    }
    private void CreateCopyOfCurrentLogFile(string filePath)
    {
        for (int i = 1; i &lt; 999; i++)
        {
            var possibleFilePath = string.Format(&quot;{0}.{1:000}&quot;, filePath, i);
            if (!File.Exists(possibleFilePath))
            {
                File.Move(filePath, possibleFilePath);
            }
        }
    }
}
</pre>
                    </div>
                </div>
                <footer>
                    <hr />
                    <div role="contentinfo">

                    </div>
                </footer>
            </div>
        </section>
    </div>
    <script src="../../../js/jquery-2.1.1.min.js"></script>
    <script src="../../../js/modernizr-2.8.3.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    <script src="../../../js/theme.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-25600919-4', 'auto');
      ga('send', 'pageview');
    
    </script>
</body>
</html>
