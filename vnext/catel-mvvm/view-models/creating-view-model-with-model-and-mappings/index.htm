<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Creating a view model with a model and mappings - Catel documentation</title>
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../css/theme_colors.css" type="text/css" />
    <link rel="stylesheet" href="../../../css/styles/vs.css">
    <link rel="stylesheet" href="../../../css/font-awesome.4.5.0.min.css">
</head>
<body role="document">
    <div class="grid-for-nav">
        <nav data-toggle="nav-shift" class="nav-side stickynav">
            <div class="side-nav-search">
                <a href="/welcome/index.htm"><i class="fa fa-home"></i> Catel documentation</a>
                <div role="search">
                    <form id="search-form" class="form" action="../../../Docnet_search.htm" method="get">
                        <input type="text" name="q" placeholder="Search docs" />
                    </form>
                </div>
            </div>
            <div class="menu menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
<ul>
<li class="tocentry"><a href="../../../home.htm">Home</a>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../introduction/">Introduction</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../faq/">FAQ</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../setup-deployment/">Setup, deployment & projects</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../getting-started/">Getting started</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../examples/">Examples</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-core/">Catel.Core</a></span>
</li>
<li class="tocentry">
<ul>
<li><span class="navigationgroup"><i class="fa fa-caret-down"></i> <a href="../../../catel-mvvm/">Catel.MVVM</a></span></li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-mvvm/auditing/">Auditing</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-mvvm/behaviors-triggers/">Behaviors & triggers</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-mvvm/bindings/">Bindings</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-mvvm/commands-events/">Commands & events</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-mvvm/converters/">Converters</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-mvvm/designers/">Designers</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-mvvm/locators-naming-conventions/">Locators & naming conventions</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-mvvm/services/">Services</a></span>
</li>
<li class="tocentry">
<ul>
<li><span class="navigationgroup"><i class="fa fa-caret-down"></i> <a href="../../../catel-mvvm/view-models/">View models</a></span></li>
<li class="tocentry"><a href="../../../catel-mvvm/view-models/introduction/">Introduction</a>
</li>
<li class="tocentry"><a href="../../../catel-mvvm/view-models/creating-basic-view-model/">Creating a basic view model</a>
</li>
<li class="tocentry"><a href="../../../catel-mvvm/view-models/creating-view-model-with-model/">Creating a view model with a model</a>
</li>
<li class="tocentry current"><a class="current" href="../../../catel-mvvm/view-models/creating-view-model-with-model-and-mappings/">Creating a view model with a model and mappings</a>
<ul class="currentrelative">
<li class="tocentry"><a href="#code-snippets">Code snippets</a></li>

<li class="tocentry"><a href="#explanation">Explanation</a></li>



</ul>
<li class="tocentry"><a href="../../../catel-mvvm/view-models/mapping-properties-from-view-to-view-model/">Mapping properties from view to view model</a>
</li>
<li class="tocentry"><a href="../../../catel-mvvm/view-models/nested-view-models/">Nested view models</a>
</li>
<li class="tocentry"><a href="../../../catel-mvvm/view-models/validation-in-view-models/">Validation in view models</a>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-mvvm/view-models/advanced/">Advanced</a></span>
</li>

</ul>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-mvvm/views/">Views</a></span>
</li>

</ul>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-fody/">Catel.Fody</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../catel-resharper/">Catel.ReSharper</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../tips-tricks/">Tips & tricks</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../reference/">API reference</a></span>
</li>

</ul>
				<div class="toc-footer">
					<span class="text-small">
						<hr/>
						<a href="https://github.com/FransBouma/DocNet" target="_blank">Made with <i class="fa fa-github"></i> DocNet</a>
					</span>
				</div>	
			</div>
            &nbsp;
        </nav>
        <section data-toggle="nav-shift" class="nav-content-wrap">
            <nav class="nav-top" role="navigation" aria-label="top navigation">
                <i data-toggle="nav-top" class="fa fa-bars"></i>
                <a href="../../../index.htm">Catel documentation</a>
            </nav>
            <div class="nav-content">
                <div role="navigation" aria-label="breadcrumbs navigation">
                    <div class="breadcrumbs">
<ul><li><a href="../../../home.htm">Home</a></li> / <li><a href="../../../catel-mvvm/index.htm">Catel.MVVM</a></li> / <li><a href="../../../catel-mvvm/view-models/index.htm">View models</a></li> / <li><a href="../../../catel-mvvm/view-models/creating-view-model-with-model-and-mappings/index.htm">Creating a view model with a model and mappings</a></li></ul>

                    </div>
                    <hr />
                </div>
                <div role="main">
                    <div class="section">
<h1 id="creating-a-view-model-with-a-model-and-mappings">Creating a view model with a model and mappings<a class="headerlink" href="#creating-a-view-model-with-a-model-and-mappings" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h1>
<p>During of the use of the MVVM pattern, we noticed that lots and lots of developers have a model, and map the values of the model to all properties of the view model. When the UI closes, the developers map all the properties back to the model. All this redundant code is not necessary when using the view models of Catel.</p>
<p>In Catel, we have created attributes that allow you to define a property as a model. A model is a property that a part of the view model represents to the user. A view model might have multiple models if it is a combination of several models.</p>
<p>To use the mapping features, the following attributes are very important:</p>
<ul>
<li><code>ModelAttribute</code> - declare a model in a view model</li>
<li><code>ViewModelToModelAttribute</code> - declare a mapping from a view model property to a model property</li>
</ul>
<p>In Catel 4.0 a new mapping mechanism is introduced that makes it possible to convert types of properties of the mappings between the <code>Model</code> and <code>ViewModel</code>. It is also possible to map to a collection of properties to a single property as result (like <code>MultiBinding</code> and <code>Converter</code> in WPF).</p>
<p>To use new mechanism you should declare this attributes:</p>
<ul>
<li>ConverterType - declare a type of converter that converts properties, converter should implement <code>IViewModelToModelConverter</code>. It is recommended to use <code>ViewModelToModelConverterBase</code> as base class for custom converters. The default converter used is <code>DefaultViewModelToModelMappingConverter</code> that provides basic 1:1 mappings between the model and view model.</li>
<li>AdditionalConstructorArgs - declare a arguments witch would be passed to converter constructor via reflection</li>
<li>AdditionalPropertiesToWatch - declare properties, which changes would trigger the converter</li>
</ul>
<h2 id="code-snippets">Code snippets<a class="headerlink" href="#code-snippets" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<ul>
<li>vm - declare a view model</li>
<li>vmpropmodel - declare a property as model on a view model</li>
<li>vmpropviewmodeltomodel - declare a property as a pass-through property on a view model&quot;</li>
</ul>
<h2 id="explanation">Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Defining a model is very simple, you only have to decorate your property with the <code>ModelAttribute</code>:</p>
<pre class="nocode">/// &lt;summary&gt;
/// Gets or sets the person.
/// &lt;/summary&gt;
[Model]
public IPerson Person
{
    get { return GetValue&lt;IPerson&gt;(PersonProperty ); }
    private set { SetValue(PersonProperty , value); }
}

/// &lt;summary&gt;
/// Register the Person property so it is known in the class.
/// &lt;/summary&gt;
public static readonly PropertyData PersonProperty = RegisterProperty(&quot;Person&quot;, typeof(IPerson));
</pre><p>Using the <code>ModelAttribute</code> is very powerful. Basically, this is the extended functionality in the view model. If the model supports <code>IEditableObject</code>, <code>BeginEdit</code> is automatically called in the initialization of the view model. When the view model is canceled, the <code>CancelEdit</code> is called so the changes are undone.</p>
<p>When a model is defined, it is possible to use the <code>ViewModelToModelAttribute</code>, as you can see in the code below:</p>
<pre class="nocode">/// &lt;summary&gt;
/// Gets or sets the FirstName of the person.
/// &lt;/summary&gt;
[ViewModelToModel(&quot;Person&quot;)]
public string FirstName
{
    get { return GetValue&lt;string&gt;(FirstNameProperty); }
    set { SetValue(FirstNameProperty, value); }
}

/// &lt;summary&gt;
/// Register the FirstName property so it is known in the class.
/// &lt;/summary&gt;
public static readonly PropertyData FirstNameProperty = RegisterProperty(&quot;FirstName&quot;, typeof(string));
 
/// &lt;summary&gt;
/// Gets or sets the LastName of the person.
/// &lt;/summary&gt;
[ViewModelToModel(&quot;Person&quot;)]
public string LastName
{
    get { return GetValue&lt;string&gt;(LastNameProperty); }
    set { SetValue(LastNameProperty, value); }
}

/// &lt;summary&gt;
/// Register the LastName property so it is known in the class.
/// &lt;/summary&gt;
public static readonly PropertyData LastNameProperty = RegisterProperty(&quot;LastName&quot;, typeof(string));
</pre><div class="alert alert-info"><span class="alert-title"><i class="fa fa-info-circle"></i> Info</span><p>If there is a single model on a view model, the name of the model in the <code>ViewModelToModel</code> can be ommitted as shown in the code below:</p>
<pre class="nocode">[ViewModelToModel]
public string FirstName
{
    get { return GetValue&lt;string&gt;(FirstNameProperty); }
    set { SetValue(FirstNameProperty, value); }
}

public static readonly PropertyData FirstNameProperty = RegisterProperty(&quot;FirstName&quot;, typeof(string));
</pre></div><p>The <code>ViewModelToModelAttribute</code> in the code example above automatically maps the view model <code>FirstName</code> and <code>LastName</code> properties to the <code>Person.FirstName</code> and <code>Person.LastName</code> properties. This way, you don’t have to manually map the values from and to the model. Another nice effect is that the view model automatically validates all objects defined using the <code>ModelAttribute</code>, and all field and business errors mapped are automatically mapped to the view model.</p>
<p>Sometimes you need the full name of a person, you can easily acquire it by creating a custom converter:</p>
<pre class="nocode">      public class CollapsMappingConverter : DefaultViewModelToModelMappingConverter
    {
        #region Fields
        private readonly char _separator;
        #endregion

        #region Constructors
        public CollapsMappingConverter(string[] propertyNames)
            : this(propertyNames, ' ')
        { }

        public CollapsMappingConverter(string[] propertyNames, char separator = ' ')
            : base(propertyNames)
        {
            _separator = separator;
        }
        #endregion

        #region Properties
        public char Separator
        {
            get { return _separator; }
        }
        #endregion

        #region Methods
        public override bool CanConvert(Type[] types, Type outType, Type viewModelType)
        {
            return types.All(x =&gt; x == typeof (string)) &amp;&amp; outType == typeof (string); //check that all input and output values are strings
        }

        public override object Convert(object[] values, IViewModel viewModel)
        {
            return string.Join(Separator.ToString(), values.Where(x =&gt; !string.IsNullOrWhiteSpace((string) x)));
        }

        public override bool CanConvertBack(Type inType, Type[] outTypes, Type viewModelType)
        {
            return outTypes.All(x =&gt; x == typeof (string)) &amp;&amp; inType == typeof (string); //check that all input and output values are strings
        }

        public override object[] ConvertBack(object value, IViewModel viewModel)
        {
            return ((string) value).Split(Separator);
        }
        #endregion
    }
</pre><p>Now, when we created the converter we should define it in mapping like this:</p>
<pre class="nocode">/// &lt;summary&gt;
/// Gets or sets the FullName of the person.
/// &lt;/summary&gt;
[ViewModelToModel(&quot;Person&quot;, &quot;FirstName&quot;, AdditionalPropertiesToWatch = new[] { &quot;LastName&quot; }, ConverterType = typeof(CollapsMappingConverter))]
public string FullName
{
    get { return GetValue&lt;string&gt;(FullNameProperty); }
    set { SetValue(FullNameProperty, value); }
}

/// &lt;summary&gt;
/// Register the LastName property so it is known in the class.
/// &lt;/summary&gt;
public static readonly PropertyData FullNameProperty = RegisterProperty(&quot;FullName&quot;, typeof(string));
</pre><p>The <code>ViewModelToModelAttribute</code> in the code example above automatically maps the view model <code>FullName</code> property to the <code>Person.FirstName</code> and <code>Person.LastName</code> properties and converts them with <code>CollapsMappingConverter</code>. This way, you don’t have to manually map the values from the model and update <code>FullName</code> property when <code>FirstName</code> or <code>LastName</code> property changed.</p>
<p>Summarized, the <code>Model</code> and <code>ViewModelToModel</code> attributes make sure no duplicate validation and no manual mappings are required.</p>
<p> </p>

                    </div>
                </div>
                <footer>
                    <hr />
                    <div role="contentinfo">

                      <p>
					    Is this section not up-to-date or found an issue? Please <a href="https://github.com/Catel/Catel.Docs/blob/master/src/../src/vnext/catel-mvvm/view-models/creating-view-model-with-model-and-mappings.md" target="_blank">contribute</a>!
					  </p>
					  <p>
					    Have a question about Catel? Use <a href="https://stackoverflow.com/questions/tagged/catel" target="_blank">StackOverflow</a> with the <i>Catel</i> tag!
					  </p>
					  <hr />
					  <p>
					    <h2>Discussion</h2>
					   <div id="disqus_thread"></div>
					   <script>
					   var disqus_config = function () {
					   this.page.url = 'http://docs.catelproject.com/catel-mvvm/view-models/creating-view-model-with-model-and-mappings/index.htm';
					   this.page.identifier = '../src/vnext/catel-mvvm/view-models/creating-view-model-with-model-and-mappings.md';
					   };
					   (function() { // DON'T EDIT BELOW THIS LINE
					   var d = document, s = d.createElement('script');
					   s.src = 'https://catel-docs.disqus.com/embed.js';
					   s.setAttribute('data-timestamp', +new Date());
					   (d.head || d.body).appendChild(s);
					   })();
					   </script>
					   <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
					  </p>
					</div>
                </footer>
            </div>
        </section>
    </div>
    <script src="../../../js/jquery-2.1.1.min.js"></script>
    <script src="../../../js/modernizr-2.8.3.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    <script src="../../../js/theme.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-25600919-4', 'auto');
      ga('send', 'pageview');
    
    </script>
</body>
</html>
