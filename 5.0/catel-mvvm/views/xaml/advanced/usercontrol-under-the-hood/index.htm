<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>UserControl - under the hood - Catel documentation</title>
    <link rel="shortcut icon" href="../../../../../favicon.ico">
    <link rel="stylesheet" href="../../../../../css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../css/theme_colors.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../css/styles/vs.css">
    <link rel="stylesheet" href="../../../../../css/font-awesome.4.5.0.min.css">
</head>
<body role="document">
    <div class="grid-for-nav">
        <nav data-toggle="nav-shift" class="nav-side stickynav">
            <div class="side-nav-search">
                <a href="/welcome/index.htm"><i class="fa fa-home"></i> Catel documentation</a>
                <div role="search">
                    <form id="search-form" class="form" action="../../../../../Docnet_search.htm" method="get">
                        <input type="text" name="q" placeholder="Search docs" />
                    </form>
                </div>
            </div>
            <div class="menu menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
<ul>
<li class="tocentry"><a href="../../../../../home.htm">Home</a>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../introduction/">Introduction</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../faq/">FAQ</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../setup-deployment/">Setup, deployment & projects</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../getting-started/">Getting started</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../examples/">Examples</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-core/">Catel.Core</a></span>
</li>
<li class="tocentry">
<ul>
<li><span class="navigationgroup"><i class="fa fa-caret-down"></i> <a href="../../../../../catel-mvvm/">Catel.MVVM</a></span></li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-mvvm/auditing/">Auditing</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-mvvm/behaviors-triggers/">Behaviors & triggers</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-mvvm/bindings/">Bindings</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-mvvm/commands-events/">Commands & events</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-mvvm/converters/">Converters</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-mvvm/designers/">Designers</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-mvvm/locators-naming-conventions/">Locators & naming conventions</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-mvvm/services/">Services</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-mvvm/view-models/">View models</a></span>
</li>
<li class="tocentry">
<ul>
<li><span class="navigationgroup"><i class="fa fa-caret-down"></i> <a href="../../../../../catel-mvvm/views/">Views</a></span></li>
<li class="tocentry">
<ul>
<li><span class="navigationgroup"><i class="fa fa-caret-down"></i> <a href="../../../../../catel-mvvm/views/xaml/">XAML</a></span></li>
<li class="tocentry"><a href="../../../../../catel-mvvm/views/xaml/window-and-datawindow/">Window and DataWindow</a>
</li>
<li class="tocentry"><a href="../../../../../catel-mvvm/views/xaml/usercontrol/">UserControl</a>
</li>
<li class="tocentry"><a href="../../../../../catel-mvvm/views/xaml/usercontrol-resources/">UserControl Resources</a>
</li>
<li class="tocentry"><a href="../../../../../catel-mvvm/views/xaml/validation-controls/">Validation controls</a>
</li>
<li class="tocentry"><a href="../../../../../catel-mvvm/views/xaml/customizing-datacontext-subscription-behavior/">Customizing DataContext subscription behavior</a>
</li>
<li class="tocentry"><a href="../../../../../catel-mvvm/views/xaml/improving-performance-by-defining-view-model-grid-manually/">Improving performance by defining the view model grid manually</a>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-mvvm/views/xaml/external-controls/">External controls</a></span>
</li>
<li class="tocentry">
<ul>
<li><span class="navigationgroup"><i class="fa fa-caret-down"></i> <a href="../../../../../catel-mvvm/views/xaml/advanced/">Advanced</a></span></li>
<li class="tocentry current"><a class="current" href="../../../../../catel-mvvm/views/xaml/advanced/usercontrol-under-the-hood/">UserControl - under the hood</a>
<ul class="currentrelative">
<li class="tocentry"><a href="#managing-the-custom-datacontext">Managing the custom DataContext</a></li>

<li class="tocentry"><a href="#main-flow">Main flow</a></li>

<li class="tocentry"><a href="#loaded">Loaded</a></li>

<li class="tocentry"><a href="#unloaded">Unloaded</a></li>

<li class="tocentry"><a href="#datacontextchanged">DataContextChanged</a></li>

<li class="tocentry"><a href="#determinedatacontext">DetermineDataContext</a></li>



</ul>
<li class="tocentry"><a href="../../../../../catel-mvvm/views/xaml/advanced/datawindow-under-the-hood/">DataWindow - under the hood</a>
</li>

</ul>
</li>

</ul>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-mvvm/views/xamarin-forms/">Xamarin.Forms</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-mvvm/views/xamarin-android/">Xamarin.Android</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-mvvm/views/xamarin-ios/">Xamarin.iOS</a></span>
</li>

</ul>
</li>

</ul>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-fody/">Catel.Fody</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../catel-resharper/">Catel.ReSharper</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../tips-tricks/">Tips & tricks</a></span>
</li>
<li class="tocentry">
<span class="navigationgroup"><i class="fa fa-caret-right"></i> <a href="../../../../../reference/">API reference</a></span>
</li>

</ul>
				<div class="toc-footer">
					<span class="text-small">
						<hr/>
						<a href="https://github.com/FransBouma/DocNet" target="_blank">Made with <i class="fa fa-github"></i> DocNet</a>
					</span>
				</div>	
			</div>
            &nbsp;
        </nav>
        <section data-toggle="nav-shift" class="nav-content-wrap">
            <nav class="nav-top" role="navigation" aria-label="top navigation">
                <i data-toggle="nav-top" class="fa fa-bars"></i>
                <a href="../../../../../index.htm">Catel documentation</a>
            </nav>
            <div class="nav-content">
                <div role="navigation" aria-label="breadcrumbs navigation">
                    <div class="breadcrumbs">
<ul><li><a href="../../../../../home.htm">Home</a></li> / <li><a href="../../../../../catel-mvvm/index.htm">Catel.MVVM</a></li> / <li><a href="../../../../../catel-mvvm/views/index.htm">Views</a></li> / <li><a href="../../../../../catel-mvvm/views/xaml/index.htm">XAML</a></li> / <li><a href="../../../../../catel-mvvm/views/xaml/advanced/index.htm">Advanced</a></li> / <li><a href="../../../../../catel-mvvm/views/xaml/advanced/usercontrol-under-the-hood/index.htm">UserControl - under the hood</a></li></ul>

                    </div>
                    <hr />
                </div>
                <div role="main">
                    <div class="section">
<h1 id="usercontrol---under-the-hood">UserControl - under the hood<a class="headerlink" href="#usercontrol---under-the-hood" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h1>
<p>The <code>UserControl</code> is a pretty sophisticated class. In this part of the documentation, the inner workings of the control are explained. What better way is there than to using flowcharts. There are a few events very important for the inner workings of the user control. The flowcharts are created per event.</p>
<p>@alert info
Keep in mind that the actual logic is implemented in the <code>UserControlLogic</code>, which is used by the <code>UserControl</code>. This way, the logic can be used by any user control via the <code>UserControlBehavior</code>.
@endif</p>
<h2 id="managing-the-custom-datacontext">Managing the custom DataContext<a class="headerlink" href="#managing-the-custom-datacontext" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>The <code>UserControl</code> logic uses an additional layer to customize the DataContext. Below is a graphical representation of how it works.</p>
<p><img src="../../../../../images/catel-mvvm/views/xaml/advanced/usercontrol-under-the-hood/overview.png" width="810" height="382" /></p>
<p>Another view can be found in the image below:</p>
<p><img src="../../../../../images/catel-mvvm/views/xaml/advanced/usercontrol-under-the-hood/hierarchy.png" width="570" height="355" /></p>
<h2 id="main-flow">Main flow<a class="headerlink" href="#main-flow" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>The following flowchart shows what happens with a user control in the main flow (the startup). First, it checks whether the user control is loaded (which is not in a normal case). If the control is loaded, it goes directly to determining the datacontext. Otherwise, it will postpone the action until the <code>Loaded</code> event. </p>
<p><img src="../../../../../images/catel-mvvm/views/xaml/advanced/usercontrol-under-the-hood/mainflow.png" width="550" height="550" /></p>
<h2 id="loaded">Loaded<a class="headerlink" href="#loaded" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>When the control is loaded, it starts checking for the first time whether the current datacontext can be used to create a view model. But, before it does this, it checks whether it should (and can) re-use an existing view model. To control whether view models should be re-used, use the <code>CloseViewModelOnUnloaded</code> property.</p>
<p>If a view model can and should be re-used, it sets the view model as data context and that's it. If there is no view model, or the previous view model should not be re-used, the control continues to determine the datacontext.</p>
<p><img src="../../../../../images/catel-mvvm/views/xaml/advanced/usercontrol-under-the-hood/loaded.png" width="550" height="550" /></p>
<h2 id="unloaded">Unloaded<a class="headerlink" href="#unloaded" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>Another event that is very important is the <code>Unloaded</code> event. In this event, the control either cleans up the view model or stores it so it can be re-used later. Then, it also restores the old datacontext so it never breaks existing application bindings. This way, the control won't leave any traces behind.</p>
<p><img src="../../../../../images/catel-mvvm/views/xaml/advanced/usercontrol-under-the-hood/unloaded.png" width="550" height="550" /></p>
<h2 id="datacontextchanged">DataContextChanged<a class="headerlink" href="#datacontextchanged" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>The <code>DataContextChanged</code> event is used to react to changes of the datacontext. We use the <code>DataContextHelper</code> class for that. If the new datacontext is new (thus not a view model that the control just set itself), it it continues to determine the datacontext. Otherwise, it will not take any action.</p>
<p><img src="../../../../../images/catel-mvvm/views/xaml/advanced/usercontrol-under-the-hood/datacontextchanged.png" width="347" height="550" /></p>
<h2 id="determinedatacontext">DetermineDataContext<a class="headerlink" href="#determinedatacontext" title="Permalink to this headline"><i class="fa fa-link" aria-hidden="true"></i></a></h2>
<p>All other flowcharts eventually led to this flowchart, the determination of the datacontext. The determination of the datacontext is very important, because this is the moment where the user control transforms the datacontext into a new view model if possible. First it tries is to construct the view model with the datacontext. So, if the datacontext is an object of type Person, and the view model of the user control has a constructor that accepts a Person object, it injects the datacontext into the constructor of the view model. If that fails, or there is simply no constructor, the control checks whether the view model has an empty constructor. If so, it constructs the view model and sets it as the new datacontext. If not, it will leave the datacontext untouched.</p>
<p>Basically, this is all that happens on a higher level to transform a datacontext into a view model. Under the hood, it's a bit more complicated but again, on a higher level this is what happens.</p>
<p><img src="../../../../../images/catel-mvvm/views/xaml/advanced/usercontrol-under-the-hood/determinedatacontext.png" width="540" height="785" /></p>

                    </div>
                </div>
                <footer>
                    <hr />
                    <div role="contentinfo">

                      <p>
					    Is this section not up-to-date or found an issue? Please <a href="https://github.com/Catel/Catel.Docs/blob/master/src/vnext/catel-mvvm/views/xaml/advanced/usercontrol-under-the-hood.md" target="_blank">contribute</a>!
					  </p>
					  <p>
					    Have a question about Catel? Use <a href="https://stackoverflow.com/questions/tagged/catel" target="_blank">StackOverflow</a> with the <i>Catel</i> tag!
					  </p>
					  <hr />
					  <p>
					    <h2>Discussion</h2>
					   <div id="disqus_thread"></div>
					   <script>
					   var disqus_config = function () {
					   // Always use vNext so comments stay visible
					   this.page.url = 'http://docs.catelproject.com/vnext/catel-mvvm/views/xaml/advanced/usercontrol-under-the-hood/index.htm';
					   this.page.identifier = 'catel-mvvm/views/xaml/advanced/usercontrol-under-the-hood.md';
					   };
					   (function() { // DON'T EDIT BELOW THIS LINE
					   var d = document, s = d.createElement('script');
					   s.src = 'https://catel-docs.disqus.com/embed.js';
					   s.setAttribute('data-timestamp', +new Date());
					   (d.head || d.body).appendChild(s);
					   })();
					   </script>
					   <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
					  </p>
					</div>
                </footer>
            </div>
        </section>
    </div>
    <script src="../../../../../js/jquery-2.1.1.min.js"></script>
    <script src="../../../../../js/modernizr-2.8.3.min.js"></script>
    <script src="../../../../../js/highlight.pack.js"></script>
    <script src="../../../../../js/theme.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-25600919-4', 'auto');
      ga('send', 'pageview');
    
    </script>
</body>
</html>
